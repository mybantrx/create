name: Trench Cloud Standby
on: 
  workflow_dispatch: # Klik manual di tab Actions

jobs:
  trench-cloud-job:
    runs-on: ubuntu-latest
    timeout-minutes: 360 # 6 jam
    
    container:
      image: ghcr.io/mybantrx/trench-panel:latest
      credentials:
        username: ${{ github.actor }}
        password: ${{ secrets.GITHUB_TOKEN }}

    steps:
      - name: Gaspol Services
        run: |
          # Nyalain SSH
          /usr/sbin/sshd
          
          # Langsung panggil tunnel (Token udah ada di ENV image)
          cloudflared tunnel --no-autoupdate run --token "$CF_TOKEN" &
          
          echo "ðŸ”¥ Trench Cloud SG-01 is UP!"
          fastfetch
          
          # Tahan sampe 6 jam
          sleep 21600          # 4. Kuncinya di sini: Sleep sampe 6 jam (21600 detik)
          # Biar GitHub Action gak nganggep job-nya udah beres
          sleep 21600
